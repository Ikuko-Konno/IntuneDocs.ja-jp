---
title: "Intune で証明書を構成する方法 | Intune Azure プレビュー | Microsoft Docs"
description: "Intune Azure プレビュー: Wi-Fi や VPN などの接続をセキュリティで保護するのに役立つ証明書を、Intune を使用して作成し、割り当てる方法について説明します。"
keywords: 
author: robstackmsft
ms.author: robstack
manager: angrobe
ms.date: 01/03/2017
ms.topic: article
ms.prod: 
ms.service: microsoft-intune
ms.technology: 
ms.assetid: 5eccfa11-52ab-49eb-afef-a185b4dccde1
ms.reviewer: heenamac
ms.suite: ems
translationtype: Human Translation
ms.sourcegitcommit: 3f05e0018fb202ab5774e935c3f59855e4aa2e75
ms.openlocfilehash: a0183f2a170ed458b19c7688b20ee5ba5c2c696e


---

# <a name="how-to-configure-certificates-with-intune-azure-preview"></a>Intune Azure プレビューを使用して証明書を構成する方法

[!INCLUDE[azure_preview](../includes/azure_preview.md)]

VPN、Wi-Fi、または電子メール プロファイル経由でユーザーが企業リソースにアクセスできるようにする場合、各ユーザー デバイスにインストールされている証明書を使用してこのアクセスを保護することができます。 大まかなワークフローは次のとおりです。

1. 適切な証明書インフラストラクチャを構成します。 [SCEP 証明書](configure-certificate-infrastructure-for-scep.md)および [PKCS 証明書](configure-certificate-infrastructure-for-pfx.md)を使用できます。
2. 各デバイスにルート証明書または中間証明機関 (CA) 証明書をインストールして、デバイスが CA の正当性を認識できるようにします。 これを行うには、**信頼された証明書プロファイル**を作成して割り当てます。 このプロファイルを割り当てると、Intune で管理しているデバイスがルート証明書を要求して受け取ります。 プラットフォームごとに別個のプロファイルを作成する必要があります。 信頼された証明書プロファイルは、次のプラットフォーム用に使用できます。
    - iOS 8.0 以降
    - macOS 10.9 以降
    - Android 4.0 以降 <!--Android for Work --->
    - Windows 8.1 以降
    - Windows Phone 8.1 以降
    - Windows 10 以降
3. デバイスが VPN、Wi-Fi、電子メールによるアクセスの認証に使用する証明書を要求するように、証明書プロファイルを作成します。 次のプラットフォームを実行するデバイスに対しては、**PKCS** または **SCEP** 証明書プロファイルを作成して展開できます。
    - iOS 8.0 以降
    - Android 4.0 以降
    - Android for Work
    - Windows 10 (Desktop および Mobile) 以降

    次のプラットフォームでは、SCEP 証明書プロファイルのみを使用できます。

-   macOS 10.9 以降
-   Windows Phone 8.1 以降

デバイス プラットフォームごとに別個のプロファイルを作成する必要があります。 プロファイルを作成したら、それを既に作成済みの信頼されたルート証明書プロファイルに関連付けます。

### <a name="further-considerations"></a>その他の注意事項

- エンタープライズ証明機関がない場合は、作成する必要があります。
- デバイス プラットフォームに基づいて Simplified Certificate Enrollment Protocol (SCEP) プロファイルを使用することにした場合は、ネットワーク デバイス登録サービス (NDES) サーバーも構成する必要があります。
- SCEP プロファイルと PKCS プロファイルのどちらを使用する場合でも、Microsoft Intune 証明書コネクタをダウンロードして構成する必要があります。

## <a name="before-you-start"></a>アップグレードを開始する前に


### <a name="if-you-want-to-use-scep-certificates"></a>SCEP 証明書を使用する場合

[SCEP 証明書インフラストラクチャ](/intune-azure/configure-devices/configure-certificate-infrastructure-for-scep)に関する記事に記載されている必要な前提条件を満たします。

### <a name="if-you-want-to-use-pkcs-certificates"></a>PKCS 証明書を使用する場合

[PKCS 証明書インフラストラクチャ](/intune-azure/configure-devices/configure-certificate-infrastructure-for-pfx)に関する記事に記載されている必要な前提条件を満たします。

## <a name="task-1-export-the-trusted-root-ca-certificate"></a>タスク 1: 信頼されたルート CA 証明書をエクスポートする
発行元 CA または発行元 CA を信頼するデバイスから、信頼されたルート証明機関 (CA) 証明書を **.cer** ファイルとしてエクスポートします。 秘密キーをエクスポートしないでください。

信頼された証明書プロファイルを構成するときにこの証明書をインポートします。

## <a name="task-2-create-trusted-certificate-profiles"></a>タスク 2: 信頼された証明書プロファイルを作成する
SCEP または PKCS 証明書プロファイルを作成する前に、信頼された証明書プロファイルを作成する必要があります。 デバイス プラットフォームごとに、信頼された証明書プロファイルと、SCEP または PKCS プロファイルが必要です。

### <a name="to-create-a-trusted-certificate-profile"></a>信頼された証明書プロファイルを作成するには

1. Azure ポータルにサインインします。
2. **[その他のサービス]** > **[その他]** > **[Intune]** の順に選択します。
3. **[Intune]** ブレードで、**[デバイスの構成]** を選択します。
2. **[デバイス構成]** ブレードで、**[管理]** > **[プロファイル]** の順に選択します。
3. [プロファイル] ブレードで、**[プロファイルを作成します]** を選択します。
4. **[プロファイルを作成します]** ブレードで、信頼された証明書プロファイルの**名前**と**説明**を入力します。
5. **[プラットフォーム]** ドロップダウン リストで、この信頼された証明書のデバイス プラットフォームを選択します。 現時点では、デバイスの制限設定に対応している次のいずれかのプラットフォームを選択できます。
    - **Android**
    - **iOS**
    - **macOS**
    - **Windows Phone 8.1**
    - **Windows 8.1 以降**
    - **Windows 10 以降**
6. **[プロファイルの種類]** ドロップダウン リストで、**[信頼済み証明書]** を選択します。
7. タスク 1 で保存した証明書を参照し、**[OK]** をクリックします。
8. Windows 8.1 および Windows 10 デバイスの場合のみ、信頼された証明書の**保存先ストア**を以下から選択します。
    - **コンピューター証明書ストア - ルート**
    - **コンピューター証明書ストア - 中間**
    - **ユーザー証明書ストア - 中間**
8. 完了したら、**[OK]** をクリックし、**[プロファイルの作成]** ブレードに戻り、**[作成]** をクリックします。

プロファイルが作成され、プロファイルの一覧ブレードに表示されます。
このプロファイルをグループに割り当てる場合は、[デバイス プロファイルを割り当てる方法](how-to-assign-device-profiles.md)に関する記事を参照してください。


> [!Note]
> Android デバイスでは、サードパーティにより信頼できる証明書がインストールされたことを知らせる通知が表示されます。

## <a name="task-3-create-scep-or-pkcs-certificate-profiles"></a>タスク 3: SCEP または PKCS 証明書プロファイルを作成する
信頼された証明書プロファイルを作成した後、使用する各プラットフォーム用の SCEP または PKCS 証明書プロファイルを作成します。 SCEP 証明書プロファイルを作成するときは、その同じプラットフォームに対する信頼された証明書プロファイルを指定する必要があります。 これにより&2; つの証明書プロファイルがリンクされますが、それでも各プロファイルを個別に割り当てる必要があります。

### <a name="to-create-an-scep-certificate-profile"></a>SCEP 証明書プロファイルを作成するには

1. Azure Portal で、**[デバイスの構成]** ワークロードを選択します。
2. **[デバイス構成]** ブレードで、**[管理]** > **[プロファイル]** の順に選択します。
3. [プロファイル] ブレードで、**[プロファイルを作成します]** を選択します。
4. **[プロファイルを作成します]** ブレードで、SCEP 証明書プロファイルの**名前**と**説明**を入力します。
5. **[プラットフォーム]** ドロップダウン リストで、この SCEP 証明書のデバイス プラットフォームを選択します。 現時点では、デバイスの制限設定に対応している次のいずれかのプラットフォームを選択できます。
    - **Android**
    - **iOS**
    - **macOS**
    - **Windows Phone 8.1**
    - **Windows 8.1 以降**
    - **Windows 10 以降**
6. **[プロファイルの種類]** ドロップダウン リストで、**[SCEP 証明書]** を選択します。
7. **[SCEP 証明書]** ブレードで、次の設定を構成します。
    - **[証明書の有効期間]** - 発行元 CA で **certutil - setreg Policy\EditFlags +EDITF_ATTRIBUTEENDDATE** コマンドを実行してカスタム有効期間を設定できるようにした場合は、証明書が失効するまでの期間を指定します。<br>指定した証明書テンプレートの有効期限よりも小さい値を指定できますが、大きい値は指定できません。 たとえば、証明書テンプレートで証明書の有効期限が&2; 年になっている場合は、この値を&1; 年することはできますが、5 年にすることはできません。 また、発行元の CA の証明書の残りの有効期限よりも小さい値を指定する必要があります。 
    - **[キー格納プロバイダー (KSP)]** (Windows Phone 8.1、Windows 8.1、Windows 10) - 証明書のキーを格納する場所を指定します。 次のいずれかの値を選択します。
        - **トラステッド プラットフォーム モジュール (TPM) KSP が存在する場合は TPM KSP に登録する (それ以外はソフトウェア KSP に登録する)**
        - **トラステッド プラットフォーム モジュール (TPM) KSP に登録する (それ以外は失敗)**
        - **Passport に登録する、それ以外は失敗 (Windows 10 以降)**
        - **ソフトウェア KSP に登録する**
    - **[サブジェクト名の形式]** - 一覧から、Intune が証明書要求のサブジェクト名をどのように自動生成するかを指定します。 証明書がユーザー用の場合、サブジェクト名にユーザーのメール アドレスを追加することもできます。 次の中から選択します。
        - **未構成**
        - **共通名**
        - **電子メールを含む共通名**
        - **電子メールとしての共通名**
    - **[サブジェクトの別名]** - Intuneが証明書要求のサブジェクトの別名 (SAN) をどのように自動生成するかを指定します。 たとえば、ユーザー証明書の種類を選択した場合は、サブジェクトの別名にユーザー プリンシパル名 (UPN) を含めることができます。 クライアント証明書を Windows ポリシー サーバーでの認証に使用する場合は、サブジェクトの別名を UPN に設定する必要があります。 
    - **[キー使用法]** - 証明書のキー使用法のオプションを指定します。 次のオプションから選択できます。 
        - **キーの暗号化:** キーが暗号化されている場合だけキーを交換できます。 
        - **デジタル署名:** キーがデジタル署名で保護されている場合だけ、キーを交換できます。 
    - **[キー サイズ (ビット)]** -キーに含まれるビット数を選択します。 
    - **[ハッシュ アルゴリズム]** (Android、Windows Phone 8.1、Windows 8.1、Windows 10) - この証明書で使用するハッシュ アルゴリズムの種類を 1 つ選択します。 接続しているデバイスをサポートするセキュリティの最も強力なレベルを選択します。 
    - **[ルート証明書]** - 既に構成してユーザーまたはデバイスに割り当てているルート CA 証明書プロファイルを選択します。 この CA 証明書は、この証明書プロファイルで構成している証明書を発行する CA のルート証明書である必要があります。 
    - **[拡張キー使用法]** - **[追加]** を選択して、証明書の使用目的に対応する値を追加します。 ほとんどの場合、ユーザーまたはデバイスがサーバーに対して認証できるように、証明書には [ **クライアント認証** ] が必要です。 ただし、必要に応じてその他のキー使用法を追加できます。 
    - **登録設定**
        - **[更新しきい値 (%)]** - 証明書の有効期間の残りがどの程度 (%) になったら、デバイスが更新を要求するかを指定します。
        - **[SCEP サーバーの URL]** - SCEP 経由で証明書を発行する NDES サーバーの URL を&1; つまたは複数指定します。 
8. 完了したら、**[プロファイルを作成します]** ブレードに戻り、**[作成]** をクリックします。

プロファイルが作成され、プロファイルの一覧ブレードに表示されます。

プロファイル構成ページの指示に従って、SCEP 証明書プロファイル設定を構成します。
>[!Note]
> iOS デバイスのみ: [サブジェクト名の形式] で、[カスタム] を選択してサブジェクト名のカスタム形式を入力します。
> カスタム形式で現在サポートされている&2; つの変数は、**共通名 (CN)** と**電子メール (E)** です。 これらの変数と静的文字列の組み合わせを使用することで、**CN={{UserName}},E={{EmailAddress}},OU=Mobile,O=Finance Group,L=Redmond,ST=Washington,C=US** のようなサブジェクト名のカスタム形式を作成できます。この例では、CN と E 変数に加えて、組織単位、組織、市区町村、州、および国の値の文字列を使用してサブジェクト名形式を作成しています。 [このトピック](https://msdn.microsoft.com/library/windows/desktop/aa377160.aspx)では、**CertStrToName** 関数とそのサポートされている文字列について説明しています。


### <a name="to-create-a-pkcs-certificate-profile"></a>PKCS 証明書プロファイルを作成するには

Azure Portal で、**[デバイスの構成]** ワークロードを選択します。
2. **[デバイス構成]** ブレードで、**[管理]** > **[プロファイル]** の順に選択します。
3. [プロファイル] ブレードで、**[プロファイルを作成します]** をクリックします。
4. **[プロファイルを作成します]** ブレードで、PKCS 証明書プロファイルの**名前**と**説明**を入力します。
5. **[プラットフォーム]** ドロップダウン リストで、この PKCS 証明書のデバイス プラットフォームを以下から選択します。
    - **Android**
    - **iOS**
    - **Windows 10 以降**
6. **[プロファイルの種類]** ドロップダウン リストで、**[PKCS 証明書]** を選択します。
7. **[PKCS 証明書]** ブレードで、次の設定を構成します。
    - **[更新しきい値 (%)]** - 証明書の有効期間の残りがどの程度 (%) になったら、デバイスが更新を要求するかを指定します。
    - **[証明書の有効期間]** - 発行元 CA で **certutil - setreg Policy\EditFlags +EDITF_ATTRIBUTEENDDATE** コマンドを実行してカスタム有効期間を設定できるようにした場合は、証明書が失効するまでの期間を指定します。<br>指定した証明書テンプレートの有効期限よりも小さい値を指定できますが、大きい値は指定できません。 たとえば、証明書テンプレートで証明書の有効期限が&2; 年になっている場合は、この値を&1; 年することはできますが、5 年にすることはできません。 また、発行元の CA の証明書の残りの有効期限よりも小さい値を指定する必要があります。
    - **[キー格納プロバイダー (KSP)]** (Windows 10) -
    - **証明機関** -
    - **証明機関名** -
    - **[証明書テンプレート名]** - ネットワーク デバイス登録サービスが使用するように構成され、発行元 CA に追加されている証明書テンプレートの名前を入力します。
    ネットワーク デバイス登録サービスを実行しているサーバーのレジストリに登録されている証明書テンプレートの名前と正確に同じ名前でなければなりません。 必ず、証明書テンプレートの表示名ではなく、証明書テンプレート自体の名前を入力してください。 
    証明書テンプレートの名前を調べるには、HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Cryptography\MSCEP というレジストリ キーを開きます。 証明書テンプレートは、[EncryptionTemplate ****]、[GeneralPurposeTemplate ****]、および [SignatureTemplate ****] の値として登録されています。 既定では、3 つの証明書テンプレートのすべての値は IPSECIntermediateOffline です。これは、**IPsec (オフライン要求)** のテンプレートの表示名にマップされます。 
    - **[サブジェクト名の形式]** - 一覧から、Intune が証明書要求のサブジェクト名をどのように自動生成するかを指定します。 証明書がユーザー用の場合、サブジェクト名にユーザーのメール アドレスを追加することもできます。 次の中から選択します。
        - **未構成**
        - **共通名**
        - **電子メールを含む共通名**
        - **電子メールとしての共通名**
    - **[サブジェクトの別名]** - Intuneが証明書要求のサブジェクトの別名 (SAN) をどのように自動生成するかを指定します。 たとえば、ユーザー証明書の種類を選択した場合は、サブジェクトの別名にユーザー プリンシパル名 (UPN) を含めることができます。 クライアント証明書を Windows ポリシー サーバーでの認証に使用する場合は、サブジェクトの別名を UPN に設定する必要があります。
    - **[拡張キー使用法]** (Android) - **[追加]** を選択して、証明書の使用目的に対応する値を追加します。 ほとんどの場合、ユーザーまたはデバイスがサーバーに対して認証できるように、証明書には [ **クライアント認証** ] が必要です。 ただし、必要に応じてその他のキー使用法を追加できます。 
    - **[ルート証明書]** (Android) - 既に構成してユーザーまたはデバイスに割り当てているルート CA 証明書プロファイルを選択します。 この CA 証明書は、この証明書プロファイルで構成している証明書を発行する CA のルート証明書である必要があります。
8. 完了したら、**[プロファイルを作成します]** ブレードに戻り、**[作成]** をクリックします。

プロファイルが作成され、プロファイルの一覧ブレードに表示されます。

## <a name="task-4-assign-certificate-profiles"></a>タスク 4: 証明書プロファイルを割り当てる

証明書プロファイルをグループに割り当てる前に、次の点を考慮します。

- 証明書プロファイルをグループに割り当てるときに、信頼された CA 証明書プロファイルの証明書ファイルは、デバイスにインストールされます。 デバイスは、SCEP または PKCS 証明書プロファイルを使用してデバイスによる証明書要求を作成します。
- 証明書プロファイルは、プロファイルを作成するときに使用するプラットフォームを実行しているデバイスのみにインストールされます。
- ユーザー コレクションまたはデバイス コレクションに証明書プロファイルをデプロイできます。
- デバイス登録後すぐに証明書をデバイスに公開するには、証明書プロファイルをデバイス グループではなくユーザー グループにデプロイします。 デバイス グループにデプロイした場合は、デバイスがポリシーを受け取る前に、デバイスの登録を完全に行う必要があります。
- 各プロファイルは個別に展開しますが、信頼されたルート CA と、SCEP または PKCS プロファイルを展開する必要もあります。 そうしないと、SCEP または PKCS 証明書ポリシーは失敗します。

## <a name="next-steps"></a>次のステップ
デバイス プロファイルを割り当てる方法に関する一般的な情報については、[デバイス プロファイルを割り当てる方法](how-to-assign-device-profiles.md)に関する記事を参照してください。



<!--HONumber=Feb17_HO1-->


